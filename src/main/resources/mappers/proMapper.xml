<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   	  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   	  
<mapper namespace = "com.kosmo.uni.persistence.ProfessorDAO">
	<select id = "getProfessorProfile" parameterType = "String" resultType = "java.util.Map">
		SELECT *
		  FROM P_PROFESSOR P
			 , A_MAJOR A
		 WHERE ID = #{id}
		   AND P.M_CODE = A.M_CODE
	</select>
	
	<select id="getMessageCnt" parameterType="String" resultType="int">
		SELECT COUNT(*) as cnt FROM p_message where receiver_id = #{id}
	</select>
	
	<select id="getMessageCnt_send" parameterType="String" resultType="int">
		SELECT COUNT(*) as cnt FROM p_message where sender_id = #{id}
	</select>
	
	<select id="getMessageCnt_notRead" parameterType="String" resultType="int">
		SELECT COUNT(*) as cnt FROM p_message where sender_id = #{id} AND readchk = 0
	</select>
	
	<select id="getMessageList" parameterType="java.util.Map" resultType="com.kosmo.uni.vo.MessageVO">
	<![CDATA[
		SELECT * FROM (SELECT num, title, content, receiver_id, receiver, sender_id, sender, readchk, reg_date, rowNum rNum 
		  FROM (SELECT * FROM p_message where receiver_id = #{id})) WHERE rNum >= #{start} AND rNum <= #{end}
	]]>
	</select>	
	
	<select id="getMessageList_send" parameterType="java.util.Map" resultType="com.kosmo.uni.vo.MessageVO">
	<![CDATA[
		SELECT * FROM (SELECT num, title, content, receiver_id, receiver, sender_id, sender, readchk, reg_date, rowNum rNum 
		  FROM (SELECT * FROM p_message where sender_id = #{id})) WHERE rNum >= #{start} AND rNum <= #{end}
	]]>
	</select>
	
	<select id="getMessage" parameterType="int" resultType="com.kosmo.uni.vo.MessageVO">
		SELECT * FROM p_message WHERE num = #{num}
	</select>
	
	<update id="updateReadChk" parameterType="int">
		UPDATE p_message SET readchk = 1 WHERE num = #{num} 
	</update>

	<select id="getMessageList_notRead" parameterType="java.util.Map" resultType="com.kosmo.uni.vo.MessageVO">
		<![CDATA[
		SELECT * FROM (SELECT num, title, content, receiver_id, receiver, sender_id, sender, readchk, reg_date, rowNum rNum 
		  FROM (SELECT * FROM p_message where sender_id = #{id} AND readchk = 0)) WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>
	<insert id="insertMessage" parameterType="java.util.Map">
		INSERT INTO P_MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, #{title}, #{content}, #{receiver_id}, #{receiver_name}, #{sender_id}, #{sender_name}, 0, SYSDATE)
	</insert>
	<select id="authenList" parameterType="String" resultType="java.util.Map">
		SELECT * FROM ${value}
	</select>
	<select id="getReceiverName" parameterType="java.util.Map" resultType="String">
		SELECT NAME FROM ${authen} WHERE ID = #{id}
	</select>
</mapper>