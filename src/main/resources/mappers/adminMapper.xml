<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   	  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosmo.uni.persistence.AdminDAO">

	<select id="getAttendance_Cnt" resultType="int">
		SELECT COUNT(*) as cnt
		FROM A_NFC
	</select>

	<select id="getAttendance_List" parameterType="java.util.Map"
		resultType="com.kosmo.uni.vo.AdminVO">
		<![CDATA[
		SELECT num, id, tagintime, tagouttime,pnum ,rNum 
		FROM (SELECT num, id, tagouttime,pnum, tagintime, rowNUM rNum
    	FROM ( 
        SELECT *FROM A_NFC n
        JOIN A_ADMIN a
        on n.pnum = a.tel))
		WHERE rNum >=#{start} AND rNum <=#{end}
    	]]>
	</select>
	
	<select id="getAttendance_List_Search"
		parameterType="java.util.Map" resultType="com.kosmo.uni.vo.AdminVO">
		<![CDATA[
		SELECT * FROM A_NFC
		WHERE TO_CHAR(inday,'YYYY-MM-DD') >=#{st, jdbcType=VARCHAR} AND TO_CHAR(inday,'YYYY-MM-DD') <=#{et, jdbcType=VARCHAR}
		]]>
	</select>
	
	<select id="getAttendance_List_Search"
		parameterType="java.util.Map" resultType="com.kosmo.uni.vo.AdminVO">
		<![CDATA[
		SELECT * FROM A_NFC
		WHERE TO_CHAR(inday,'YYYY-MM-DD') >=#{st, jdbcType=VARCHAR} AND TO_CHAR(inday,'YYYY-MM-DD') <=#{et, jdbcType=VARCHAR}
		]]>
	</select>
	
	<select id="getSalary_list_human" parameterType="java.util.Map"
		resultType="com.kosmo.uni.vo.AdminVO">
		SELECT 
		s.salary_inday,
		s.sal_num,
		s.id,
		s.salary_month,
		m.name,
		m.depart
		FROM A_SALARY s join A_ADMIN m
		ON s.id = m.id
	</select>
	
	<insert id="salary_input" parameterType="java.util.Map">
		INSERT INTO A_SALARY_INPUT
		VALUES (salaryList_seq.nextVal,#{salary_division},#{payments_division},#{payments_start},#{payments_end},#{salary_inday},#{payments_month},#{salary_name})
	</insert>
	
	<select id="getSalaryCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM A_SALARY_INPUT
	</select>
	
	<select id="getSalaryList" parameterType="java.util.Map" resultType="com.kosmo.uni.vo.SalaryInputVO">
		<![CDATA[
		SELECT * 
			FROM (SELECT salary_input_num, salary_division, payments_division, salary_confirm
	        , salary_inday, payments_month, salary_name, rowNUM rNum 
			FROM ( SELECT * FROM A_SALARY_INPUT ORDER BY salary_input_num ASC))
		WHERE rNum >=#{start} AND rNum <=#{end}
		]]>
	</select>
	
	<select id="getCourseCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM A_COURSE
	</select>
	<select id="getCourseList" resultType="com.kosmo.uni.vo.CourseVO">
		SELECT co_code
            , co_name
            , m_code
            , p_code
    		, limit_num
     		, co_num
            , grade
     		, co_year
            , co_semester
            , co_day
            , le_code
     		, p_name
     		, school_year
  		FROM A_COURSE
	</select>

	<select id="getAdminCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM a_admin
	</select>
	
	<delete id="classDelete" parameterType="String">
		DELETE FROM A_COURSE WHERE co_code = #{co_code}
	</delete>
	
	<insert id="classInsert" parameterType="com.kosmo.uni.vo.CourseVO">
		INSERT INTO A_COURSE
		VALUES (#{m_code} || CASE WHEN #{co_year} > 2000 THEN TO_CHAR(MOD(#{co_year},2000)) || LPAD(COU_SEQ.nextval, 4, '0') ELSE TO_CHAR(MOD(#{co_year},1900)) || LPAD(COU_SEQ.nextval, 4, '0') END,#{co_name},#{m_code},
		#{p_name},#{p_code},#{limit_num},#{co_num},#{grade},
		#{co_year},#{co_semester},#{co_day},#{le_code},#{school_year})
	</insert>
	
	<select id="classInfo" resultType="com.kosmo.uni.vo.CourseVO">
		SELECT co_code, co_name, m_code, p_code, limit_num, co_num, grade, co_year
            , co_semester, co_day, le_code, p_name, school_year FROM A_COURSE WHERE co_code = #{code}
	</select>
	
	<update id="classmodClear" parameterType="com.kosmo.uni.vo.CourseVO">
		UPDATE A_COURSE SET co_name = #{co_name}, m_code = #{m_code}, 
		p_code = #{p_code}, limit_num = #{limit_num}, grade = #{grade}, 
		co_year = #{co_year}, co_semester = #{co_semester}, co_day = #{co_day}, 
		le_code = #{le_code}, p_name = #{p_name}, school_year = #{school_year} WHERE co_code = #{co_code}
	</update>
	
	<select id="getParkingCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM A_PARKING
	</select>
	
	<select id="getParkingList" resultType="com.kosmo.uni.vo.ParkVO">
		SELECT * FROM A_PARKING ORDER BY num desc
	</select>
	
	<select id="getSearchList" resultType="com.kosmo.uni.vo.ParkVO">
		SELECT * FROM A_PARKING WHERE PINTIME LIKE '%'||#{date}||'%'
	</select>
	
	<select id="getCarNumList" resultType="com.kosmo.uni.vo.ParkVO">
		SELECT * FROM A_PARKING WHERE CARNUM LIKE '%'||#{date}||'%'
	</select>
</mapper>